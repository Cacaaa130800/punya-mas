<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mood Tracker Mas üíô</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --bg:#e7f1ff; --text:#1a2a3a; --card:#ffffff; --accent:#6fa8dc; }
    .dark { --bg:#0f1621; --text:#f1f6ff; --card:#1d2b40; --accent:#4a90e2; }
    *{box-sizing:border-box}
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--text);
      margin:0;
      padding:20px;
      display:flex;
      flex-direction:column;
      align-items:center;
      transition:background .25s, color .25s;
    }
    h1{margin:6px 0 8px 0}
    .controls{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px}
    .btn{
      padding:8px 12px; border-radius:10px; border:none; cursor:pointer;
      background:var(--accent); color:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.12)
    }
    .secondary{background:transparent; color:var(--text); border:1px solid rgba(0,0,0,0.08)}
    .mood-container{display:flex; gap:14px; margin:18px 0; justify-content:center; flex-wrap:wrap}
    .mood{font-size:38px; cursor:pointer; transition:transform .12s}
    .mood:hover{transform:scale(1.18)}
    .card{
      background:var(--card);
      padding:14px;
      width:92%;
      max-width:560px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(16,24,40,0.06);
      margin-top:14px;
    }
    textarea{width:100%; height:78px; border-radius:10px; padding:10px; border:1px solid #ccc; resize:vertical;
      background:transparent; color:var(--text)}
    #reaction{margin-top:12px; font-size:18px; text-align:center; min-height:36px}
    #entries div, #notes div{padding:8px 0; border-bottom:1px dashed rgba(0,0,0,0.06)}
    #sticker{position:fixed; right:12px; bottom:12px; width:120px; display:none; z-index:999}
    /* sticker animation */
    #sticker.show{display:block; transform:translateY(0); transition:transform .45s ease, opacity .35s}
    #sticker.hidden{opacity:0; transform:translateY(20px)}
    /* love hearts */
    .loveHeart{position:fixed; font-size:28px; animation:floatUp 2.4s ease-out; pointer-events:none; z-index:9999}
    @keyframes floatUp{0%{transform:translateY(0);opacity:1}100%{transform:translateY(-160px);opacity:0}}
    /* secret modal */
    #secretModal{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(3px); align-items:center; justify-content:center; z-index:2000}
    #secretModal .box{background:var(--card); color:var(--text); padding:18px; border-radius:14px; width:88%; max-width:420px; text-align:center}
    /* mobile tweaks */
    @media (max-width:420px){ .mood{font-size:34px} #sticker{width:96px} }
  </style>
</head>
<body>
  <h1>Mood Tracker Mas üíô</h1>

  <div class="controls">
    <button id="themeBtn" class="btn">üåô Mode</button>
    <button id="musicBtn" class="btn">‚ñ∂ Backsound</button>
    <button id="resetDataBtn" class="btn secondary">‚ö†Ô∏è Reset Semua Data</button> 
    <button id="secretBtn" class="btn secondary">üíå Surat Rahasia</button>
    <button id="downloadBtn" class="btn secondary">‚¨áÔ∏è Download HTML</button>
  </div>

  <p style="margin:6px 0 0 0">Klik mood mas hari ini ‚Äî langsung muncul reaksi manis dari caca:</p>

  <div class="mood-container">
    <span class="mood" data-mood="üòÑ Senang">üòÑ</span>
    <span class="mood" data-mood="üôÇ Biasa aja">üôÇ</span>
    <span class="mood" data-mood="üò¢ Sedih">üò¢</span>
    <span class="mood" data-mood="üò° Kesel">üò°</span>
    <span class="mood" data-mood="ü•∞ Sayang caca">ü•∞</span>
  </div>

  <div id="reaction"></div>

  <div class="card">
    <h3>Catatan Mood & Statistik</h3>
    <canvas id="moodChart" height="140"></canvas>
    <div id="entries" style="margin-top:10px"></div>
  </div>

  <div class="card">
    <h3>Catatan Penting dari Mas</h3>
    <textarea id="noteInput" placeholder="Mas mau nulis apa ke caca?"></textarea>
    <div style="display:flex; gap:8px; margin-top:8px">
      <button id="saveNote" class="btn">Simpan Catatan</button>
      <button id="clearNotes" class="btn secondary">Bersihkan Semua</button>
    </div>
    <div id="notes" style="margin-top:12px"></div>
  </div>

  <div class="card" style="cursor:pointer; text-align:center" id="secretPreview">
    <h3>üíô Buka Halaman Rahasia</h3>
    <small>Klik tombol Surat Rahasia atau tombol di atas</small>
  </div>

  <img id="sticker" src="https://i.imgur.com/cy7Q5pA.png" alt="cute sticker">

  <div id="secretModal">
    <div class="box">
      <h2>Pesan Rahasia Buat Mas üíå</h2>
      <p>Mas tuh rumah ternyaman caca... ü©µ<br>makasih udah ada di hidup caca yaaa...</p>
      <div style="margin-top:12px">
        <button id="closeSecret" class="btn">Tutup</button>
      </div>
    </div>
  </div>

  <audio id="bgm" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg">
    </audio>

<script>
/* --- Utility & state --- */
const moodButtons = document.querySelectorAll('.mood');
const reaction = document.getElementById('reaction');
const entriesBox = document.getElementById('entries');
const notesBox = document.getElementById('notes');
const noteInput = document.getElementById('noteInput');
const bgm = document.getElementById('bgm');
const sticker = document.getElementById('sticker');
const secretModal = document.getElementById('secretModal');
let moodChart;
let isDark = false;

/* --- Data helpers --- */
function loadLogs(){ return JSON.parse(localStorage.getItem('masMoodLog')||'[]'); }
function saveLogs(logs){ localStorage.setItem('masMoodLog', JSON.stringify(logs)); }
function loadNotes(){ return JSON.parse(localStorage.getItem('masNotes')||'[]'); }
function saveNotes(n){ localStorage.setItem('masNotes', JSON.stringify(n)); }

/* --- Reactions map --- */
const reactions = {
  'üòÑ Senang':'mas seneng?? ya ampun aku ikut senenggg üò≠üíô peluk dulu sini ü´Ç',
  'üôÇ Biasa aja':'mas biasa aja ya hari ini? sini aku temenin biar makin happy ü©µ',
  'üò¢ Sedih':'kok mas sedihhhh üò≠üíô cini ciniiiiii, aku peyukkkkk ü´Çü©µ',
  'üò° Kesel':'siapa yang bikin mas kesel?? ceritain yaaaa, biar aku cubit orang yang nakalin masssss üò§üíô',
  'ü•∞ Sayang caca':'aaaa mas sayang akuuuu?? aku juga sayang mas banyak banyakkkkkkk ü•πü©µüíô'
};

/* --- Mood click handler --- */
moodButtons.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const mood = btn.dataset.mood;
    const date = new Date().toLocaleString();
    const entry = { mood, date };
    const logs = loadLogs();
    logs.unshift(entry);
    saveLogs(logs);
    renderLogs();
    showReaction(mood);
    spawnTinyHearts();
    if(mood.includes('Sayang')) spawnBigHearts();
    // make sticker show briefly
    showSticker();
    updateChart();
  });
});

/* --- Render logs & notes --- */
function renderLogs(){
  const logs = loadLogs();
  entriesBox.innerHTML = '';
  if(logs.length===0) entriesBox.innerHTML = '<em>Belum ada mood tercatat.</em>';
  logs.forEach(l=>{
    const d = document.createElement('div');
    d.textContent = `${l.date} ‚Äî ${l.mood}`;
    entriesBox.appendChild(d);
  });
}
function renderNotes(){
  const notes = loadNotes();
  notesBox.innerHTML = '';
  if(notes.length===0) notesBox.innerHTML = '<em>Belum ada catatan.</em>';
  notes.forEach(n=>{
    const d = document.createElement('div');
    d.textContent = `${n.time} ‚Äî ${n.text}`;
    notesBox.appendChild(d);
  });
}

/* --- Notes save/clear --- */
document.getElementById('saveNote').addEventListener('click', ()=>{
  const text = noteInput.value.trim();
  if(!text) return;
  const notes = loadNotes();
  notes.unshift({ text, time: new Date().toLocaleString() });
  saveNotes(notes);
  noteInput.value='';
  renderNotes();
});
document.getElementById('clearNotes').addEventListener('click', ()=>{
  if(confirm('Bersihkan semua catetan?')){ localStorage.removeItem('masNotes'); renderNotes(); }
});

/* --- Reaction display & sticker --- */
function showReaction(mood){
  reaction.textContent = reactions[mood] || '';
}
function showSticker(){
  sticker.classList.remove('hidden');
  sticker.classList.add('show');
  sticker.style.opacity='1';
  setTimeout(()=>{
    sticker.classList.remove('show');
    sticker.classList.add('hidden');
  }, 3000);
}

/* --- Hearts animations --- */
function spawnTinyHearts(){
  for(let i=0;i<6;i++){
    const h = document.createElement('div');
    h.className='loveHeart';
    h.textContent='üíô';
    h.style.left = Math.random()*92 + 'vw';
    h.style.bottom = '-10px';
    document.body.appendChild(h);
    setTimeout(()=>h.remove(), 2500);
  }
}
function spawnBigHearts(){
  for(let i=0;i<12;i++){
    const h = document.createElement('div');
    h.className='loveHeart';
    h.style.fontSize = 34 + Math.floor(Math.random()*18) + 'px';
    h.textContent = 'üíñ';
    h.style.left = (40 + Math.random()*20) + 'vw';
    h.style.bottom = '-10px';
    document.body.appendChild(h);
    setTimeout(()=>h.remove(), 2600);
  }
}

/* --- Secret modal handlers --- */
document.getElementById('secretBtn').addEventListener('click', ()=>{ secretModal.style.display='flex'; });
document.getElementById('closeSecret').addEventListener('click', ()=>{ secretModal.style.display='none'; });
document.getElementById('secretPreview').addEventListener('click', ()=>{ secretModal.style.display='flex'; });

/* --- Music toggle --- */
document.getElementById('musicBtn').addEventListener('click', ()=>{
  if(bgm.paused){ bgm.play(); document.getElementById('musicBtn').textContent='‚è∏ Backsound'; }
  else { bgm.pause(); document.getElementById('musicBtn').textContent='‚ñ∂ Backsound'; }
});
bgm.addEventListener('play', ()=>{ document.getElementById('musicBtn').textContent='‚è∏ Backsound'; });
bgm.addEventListener('pause', ()=>{ document.getElementById('musicBtn').textContent='‚ñ∂ Backsound'; });

/* --- Theme toggle --- */
document.getElementById('themeBtn').addEventListener('click', ()=>{
  document.body.classList.toggle('dark'); isDark = document.body.classList.contains('dark');
  document.getElementById('themeBtn').textContent = isDark ? '‚òÄÔ∏è Mode' : 'üåô Mode';
});

/* --- Download HTML button (gives current file) --- */
document.getElementById('downloadBtn').addEventListener('click', ()=>{
  const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'mood_tracker_mas.html';
  document.body.appendChild(a); a.click();
  a.remove(); URL.revokeObjectURL(url);
});

/* --- Chart --- */
function updateChart(){
  const logs = loadLogs();
  const moodNames = ['üòÑ Senang','üôÇ Biasa aja','üò¢ Sedih','üò° Kesel','ü•∞ Sayang caca'];
  const counts = moodNames.map(m => logs.filter(l => l.mood===m).length);
  const ctx = document.getElementById('moodChart').getContext('2d');
  if(moodChart) moodChart.destroy();
  moodChart = new Chart(ctx, {
    type:'bar',
    data: { labels: moodNames, datasets: [{ label:'Jumlah', data: counts, backgroundColor: ['#66c2ff','#99d6ff','#aab6ff','#c0c0ff','#ffb6c1'] }] },
    options: { responsive:true, plugins:{ legend:{display:false} }, scales:{ y:{ beginAtZero:true, ticks:{precision:0} } } }
  });
}

/* --- New: Reset Data Handler --- */
document.getElementById('resetDataBtn').addEventListener('click', ()=>{
  if(confirm('Yakin ingin menghapus SEMUA data mood dan catatan? Ini tidak bisa dikembalikan!')){
    localStorage.removeItem('masMoodLog');
    localStorage.removeItem('masNotes');
    alert('Data berhasil di-reset! Silakan muat ulang halaman.');
    window.location.reload();
  }
});

/* --- Init --- */
renderLogs(); renderNotes(); updateChart();

/* --- small compatibility: if bgm blocked by browser autoplay policies, user can tap Backsound button --- */

/* --- Accessibility: keyboard enter on textarea saves note --- */
noteInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && (e.ctrlKey||e.metaKey)){ document.getElementById('saveNote').click(); e.preventDefault(); }});
</script>
</body>
</html>
